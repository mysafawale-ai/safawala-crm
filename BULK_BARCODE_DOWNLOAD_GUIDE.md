# 📥 Bulk Barcode Download Feature

## ✅ What's New

Professional bulk barcode PDF generation with **3 layout options** for different use cases.

---

## 🎨 PDF Layout Options

### **1. Adhesive Labels** (Default)
- **Format**: Avery 5160 compatible
- **Layout**: 3 columns × 10 rows = 30 labels per page
- **Use Case**: Print on adhesive label sheets and stick to products
- **Best For**: Quick labeling, retail products, small items

```
┌─────┬─────┬─────┐
│ Bar │ Bar │ Bar │
│code │code │code │
│TUR01│TUR02│TUR03│
├─────┼─────┼─────┤
│ ... (30 labels per page)
└─────┴─────┴─────┘
```

---

### **2. Barcode Sheet**
- **Format**: Large barcodes with details
- **Layout**: 2 columns × 4 rows = 8 per page
- **Use Case**: Warehouse inventory scanning
- **Best For**: Large items, easy scanning from distance, storage bins

```
┌───────────────┬───────────────┐
│  [Barcode]    │  [Barcode]    │
│  TUR-0001     │  TUR-0002     │
│ Barati Safa   │ Barati Safa   │
│ Status: Avail │ Status: Avail │
├───────────────┼───────────────┤
│  (8 per page with full details)
└───────────────┴───────────────┘
```

---

### **3. Inventory List**
- **Format**: Detailed inventory report
- **Layout**: List view with all information
- **Use Case**: Inventory audits, stock verification
- **Best For**: Reports, documentation, tracking

```
╔═══════════════════════════════════════╗
║ Barcode Inventory List                ║
╠═══════════════════════════════════════╣
║ [Barcode] TUR-0001                    ║
║           Barati Safa                 ║
║           Status: Available           ║
║           Location: Warehouse A       ║
╠═══════════════════════════════════════╣
║ [Barcode] TUR-0002                    ║
║ ...                                   ║
╚═══════════════════════════════════════╝
```

---

## 🚀 How to Use

### **Option 1: From Inventory Page** (Recommended)

```typescript
// In your product detail component
import { BulkBarcodeDownloadDialog } from '@/components/inventory/bulk-barcode-download-dialog'

const [showDownloadDialog, setShowDownloadDialog] = useState(false)
const [barcodeItems, setBarcodeItems] = useState<BarcodeItem[]>([])

// Fetch items
const loadItems = async () => {
  const { data } = await supabase
    .from('product_items')
    .select('id, item_code, barcode, status, location')
    .eq('product_id', productId)
  
  setBarcodeItems(data || [])
}

// Show dialog
<BulkBarcodeDownloadDialog
  items={barcodeItems}
  productName={product.name}
  open={showDownloadDialog}
  onOpenChange={setShowDownloadDialog}
/>
```

---

### **Option 2: Direct API Usage**

```typescript
import { downloadBarcodesAsPDF, downloadBarcodeLabels, downloadBarcodeSheet } from '@/lib/barcode/bulk-download-pdf'

// Quick download with default options (labels)
await downloadBarcodeLabels(items, 'barati_safa_labels.pdf')

// Large barcode sheet
await downloadBarcodeSheet(items, 'warehouse_barcodes.pdf')

// Custom options
await downloadBarcodesAsPDF(items, 'custom.pdf', {
  layout: 'list',
  includeProductName: true,
  includeLocation: true,
  includeItemCode: true,
})
```

---

## 🎯 Integration with Auto-Generate System

Works seamlessly with the new auto-generate feature:

```typescript
// After auto-generating items
const handleStockUpdate = async (newStock: number) => {
  // Update stock (triggers auto-generate)
  await supabase
    .from('products')
    .update({ stock_available: newStock })
    .eq('id', productId)
  
  // Items are auto-generated by trigger
  
  // Fetch newly generated items
  const { data: newItems } = await supabase
    .from('product_items')
    .select('*')
    .eq('product_id', productId)
    .order('created_at', { ascending: false })
    .limit(newStock - oldStock)
  
  // Download them immediately
  await downloadBarcodeLabels(newItems, 'new_labels.pdf')
}
```

---

## 📋 UI Component Features

The `BulkBarcodeDownloadDialog` provides:

✅ **3 Layout Options** with visual previews  
✅ **Customization Options**:
   - Include/exclude item code
   - Include/exclude product name
   - Include/exclude location
   
✅ **Smart Defaults**:
   - Labels: Minimal info (item code only)
   - Sheet: Product name included
   - List: All information included

✅ **Live Preview**:
   - Shows estimated page count
   - Shows total items
   - Layout description

---

## 🖨️ Printing Tips

### **For Adhesive Labels:**
1. Use Avery 5160 label sheets (or compatible)
2. Print settings: Actual size, no scaling
3. Use laser or inkjet printer
4. Test with 1 page first

### **For Barcode Sheets:**
1. Use standard A4 paper
2. Print settings: Fit to page
3. Works with any printer
4. Laminate for durability (optional)

### **For Inventory Lists:**
1. Standard A4/Letter paper
2. Can print double-sided
3. Hole-punch and file in binder
4. Perfect for stock audits

---

## 🎨 Customization Examples

### **Example 1: Mini Labels (60 per page)**

```typescript
// Create custom layout in bulk-download-pdf.ts
const cols = 6
const rows = 10
const labelsPerPage = 60
```

### **Example 2: QR Codes Instead of Barcodes**

```typescript
// Add QR code generation option
function generateQRCodeDataURL(code: string): string {
  // Use QRCode library
  return QRCode.toDataURL(code)
}
```

### **Example 3: Color-Coded Status**

```typescript
// In downloadAsSheet function
if (item.status === 'available') {
  pdf.setTextColor(0, 128, 0) // Green
} else if (item.status === 'booked') {
  pdf.setTextColor(255, 165, 0) // Orange
}
```

---

## 📊 Use Cases

| Scenario | Layout | Settings |
|----------|--------|----------|
| **New Product Launch** | Labels | Item code only, 200 labels |
| **Warehouse Organization** | Sheet | Product name, location |
| **Stock Audit** | List | All details, sort by location |
| **Return Verification** | List | Filter by status='booked' |
| **Replacement Labels** | Labels | Specific items only |

---

## 🔧 Advanced Features

### **Filter Before Download**

```typescript
// Only download available items
const availableItems = allItems.filter(item => item.status === 'available')
await downloadBarcodeLabels(availableItems, 'available_only.pdf')

// Only download items in specific location
const warehouseA = allItems.filter(item => item.location === 'Warehouse A')
await downloadBarcodeSheet(warehouseA, 'warehouse_a.pdf')
```

### **Batch Download Multiple Products**

```typescript
const products = ['Barati Safa', 'Royal Turban', 'Premium Sherwani']

for (const productName of products) {
  const items = await fetchItemsByProduct(productName)
  await downloadBarcodeLabels(
    items,
    `${productName.replace(/\s+/g, '_')}_labels.pdf`
  )
}
```

---

## ✅ Testing Checklist

- [ ] Download as Labels (30 per page)
- [ ] Download as Sheet (8 per page)  
- [ ] Download as List (detailed view)
- [ ] Print on actual label sheets
- [ ] Scan printed barcodes (verify readability)
- [ ] Test with 1 item, 10 items, 200 items
- [ ] Test all customization options
- [ ] Verify PDF opens correctly
- [ ] Check page breaks are correct

---

## 🐛 Troubleshooting

**Issue: Barcodes not scanning**
- Increase barcode width/height in generator
- Use higher quality paper
- Ensure printer resolution is high

**Issue: Labels misaligned on sheet**
- Check printer margins
- Use "Actual size" print setting
- Calibrate with test page

**Issue: PDF too large**
- Reduce barcode image quality
- Use fewer items per download
- Split into multiple PDFs

---

## 🎉 Benefits

✅ **Save Time**: Download 200 labels in one click  
✅ **Professional**: Consistent formatting  
✅ **Flexible**: 3 layouts for different needs  
✅ **Integrated**: Works with auto-generate system  
✅ **Printable**: Ready for any printer  
✅ **Customizable**: Full control over content  

---

## 📝 Next Enhancements (Future)

- [ ] **QR Code Option**: Toggle between barcode/QR
- [ ] **Custom Label Sizes**: Support more Avery formats
- [ ] **Color Coding**: Status-based colors
- [ ] **Batch Products**: Multiple products in one PDF
- [ ] **Email PDF**: Send directly to printer email
- [ ] **Cloud Storage**: Auto-upload to Google Drive

---

**Ready to use! 🚀**
