# üéØ SAFAWALA CRM - OPTIMAL SETUP WORKFLOW GUIDE

## ‚úÖ **The Correct Order to Avoid All Errors**

This guide shows you the **exact order** to set up your CRM system to avoid dependency errors and foreign key violations.

---

## üìä **Database Dependency Tree**

```
Level 1 (Foundation - No Dependencies)
‚îú‚îÄ üè¢ Franchises          ‚Üê Start here!
‚îÇ
Level 2 (Requires Franchise)
‚îú‚îÄ üë• Users/Staff         ‚Üê Requires franchise_id
‚îú‚îÄ üëî Customers          ‚Üê Requires franchise_id
‚îú‚îÄ üè≠ Vendors            ‚Üê Requires franchise_id
‚îÇ
Level 3 (Requires Franchise + Maybe Category)
‚îú‚îÄ üì¶ Product Categories  ‚Üê Optional but recommended
‚îú‚îÄ üì¶ Products/Inventory  ‚Üê Requires franchise_id (+ category_id)
‚îú‚îÄ üéÅ Package Categories  ‚Üê For package system
‚îú‚îÄ üéÅ Package Sets        ‚Üê Requires franchise_id + category_id
‚îÇ
Level 4 (Requires Products/Packages)
‚îú‚îÄ üéÅ Package Variants    ‚Üê Requires package_id
‚îú‚îÄ üî¢ Product Items       ‚Üê Requires product_id (barcode system)
‚îÇ
Level 5 (Requires Customers + Products)
‚îú‚îÄ üìã Quotes              ‚Üê Requires customer_id + franchise_id
‚îú‚îÄ üõí Product Orders      ‚Üê Requires customer_id + franchise_id
‚îú‚îÄ üì¶ Package Bookings    ‚Üê Requires customer_id + franchise_id
‚îÇ
Level 6 (Requires Bookings)
‚îú‚îÄ üìÑ Invoices            ‚Üê Requires booking_id
‚îú‚îÄ üí∞ Payments            ‚Üê Requires booking_id
‚îú‚îÄ üöö Deliveries          ‚Üê Requires booking_id
‚îú‚îÄ üîÑ Returns             ‚Üê Requires booking_id/delivery_id
‚îÇ
Level 7 (Optional - Support Systems)
‚îú‚îÄ üß∫ Laundry Batches     ‚Üê Requires products
‚îú‚îÄ üí∏ Expenses            ‚Üê Requires franchise_id
‚îú‚îÄ üìä Reports             ‚Üê Requires all data
‚îî‚îÄ üîî Notifications       ‚Üê Auto-generated
```

---

## üöÄ **STEP-BY-STEP SETUP WORKFLOW**

### **Phase 1: Foundation Setup** (Day 1)

#### **Step 1.1: Create Franchises** ‚≠ê **START HERE**
```
Why First: Everything else requires franchise_id
Location: Settings ‚Üí Franchises ‚Üí Add Franchise

Required Fields:
- Franchise Name (e.g., "Safawala Delhi")
- Franchise Code (e.g., "DEL-001")
- Address, City, State, Pincode
- Phone, Email
- Owner Name
- GST Number (optional)

‚úÖ Test: Create 1 franchise first
```

**Common Errors:**
- ‚ùå Duplicate franchise code
- ‚ùå Invalid email format
- ‚ùå Missing required fields

**How to Fix:**
- Use unique codes: DEL-001, MUM-001, BLR-001
- Verify email format: owner@safawala.com
- Fill all required fields before saving

---

#### **Step 1.2: Create Users/Staff**
```
Why Now: Staff need franchise_id assigned
Location: Settings ‚Üí Staff ‚Üí Add Staff

Required Fields:
- Name
- Email (unique)
- Phone
- Role (Admin, Manager, Staff)
- Franchise (select from dropdown)
- Password (auto-generated or custom)

‚úÖ Test: Create 1 admin user per franchise
```

**Common Errors:**
- ‚ùå Duplicate email address
- ‚ùå No franchise selected
- ‚ùå Invalid role

**How to Fix:**
- Each user needs unique email
- Always select a franchise
- Use predefined roles only

---

### **Phase 2: Master Data** (Day 1-2)

#### **Step 2.1: Create Customers**
```
Why Now: Required for creating bookings
Location: Customers ‚Üí Add Customer

Required Fields:
- Customer Name
- Phone (unique per franchise)
- Email (optional)
- Address
- City, State, Pincode
- Franchise (auto-assigned from logged-in user)

‚úÖ Test: Create 3-5 test customers
```

**Common Errors:**
- ‚ùå Duplicate phone number (within same franchise)
- ‚ùå Missing franchise_id
- ‚ùå Invalid pincode format

**How to Fix:**
- Phone numbers must be unique per franchise
- System auto-assigns franchise_id (don't worry)
- Use 6-digit pincodes only

---

#### **Step 2.2: Create Product Categories** (Optional but Recommended)
```
Why Now: Makes product organization easier
Location: Inventory ‚Üí Categories ‚Üí Add Category

Examples:
- Turbans
- Sherwani
- Accessories
- Shoes
- Jewelry

‚úÖ Test: Create 5-10 categories
```

---

#### **Step 2.3: Create Products/Inventory** ‚≠ê **IMPORTANT**
```
Why Now: Required for bookings
Location: Inventory ‚Üí Products ‚Üí Add Product

Required Fields:
- Product Name (e.g., "Royal Wedding Turban")
- Product Code (e.g., "TUR-001")
- Category (select from dropdown)
- Rental Price
- Sale Price
- Security Deposit
- Stock Available (e.g., 50)
- Franchise (auto-assigned)

‚ö° NEW: Auto-Generate Barcodes Feature
- If enabled: Creates 50 barcoded items automatically!
- If disabled: Add items manually later

‚úÖ Test: Create 10-20 products
```

**Common Errors:**
- ‚ùå Duplicate product code
- ‚ùå Stock = 0 (can't book)
- ‚ùå No category selected
- ‚ùå Negative prices

**How to Fix:**
- Use unique codes: TUR-001, TUR-002, SHE-001
- Always set stock_available > 0
- Create categories first (Step 2.2)
- All prices must be positive numbers

---

#### **Step 2.4: Create Package Categories** (If using packages)
```
Location: Packages ‚Üí Categories

Examples:
- Groom Packages
- Bride Packages
- Complete Wedding
- Kids Packages
```

---

#### **Step 2.5: Create Package Sets** (If using packages)
```
Location: Packages ‚Üí Package Sets ‚Üí Add Package

Required Fields:
- Package Name (e.g., "Royal Groom Package")
- Category (select from dropdown)
- Base Price
- Security Deposit
- Extra Safa Price
- Franchise (auto-assigned)

‚úÖ Test: Create 5-10 packages
```

---

#### **Step 2.6: Create Package Variants**
```
Location: Packages ‚Üí Variants ‚Üí Add Variant

Required Fields:
- Package (select from dropdown)
- Variant Name (e.g., "Premium", "Deluxe")
- Base Price
- Security Deposit
- Inclusions (list items)

‚úÖ Test: Create 2-3 variants per package
```

---

### **Phase 3: Barcode System** (Optional - Day 2-3)

#### **Step 3.1: Generate Barcodes for Products**
```
Why Now: For individual item tracking
Location: Inventory ‚Üí Product ‚Üí Actions ‚Üí Generate Item Barcodes

Process:
1. Select product
2. Enter quantity (e.g., 200)
3. Click "Generate"
4. Download PDF labels
5. Print and apply to physical items

‚úÖ Test: Generate 10 barcodes for 1 product
```

**What Happens:**
- Creates product_items table entries
- Generates unique barcodes (TUR-0001, TUR-0002, etc.)
- Auto-syncs with stock_available
- Ready for scanning during bookings

---

### **Phase 4: Business Operations** (Day 3+)

#### **Step 4.1: Create Quotes** (Optional)
```
Location: Quotes ‚Üí Create Quote

Required Fields:
- Customer (select from dropdown)
- Event Date
- Products/Packages
- Quantities
- Pricing

‚úÖ Test: Create 2-3 quotes
```

**Common Errors:**
- ‚ùå Customer not found (create customer first - Step 2.1)
- ‚ùå Product not found (create products first - Step 2.3)

---

#### **Step 4.2: Create Product Orders** ‚≠ê **MAIN WORKFLOW**
```
Location: Bookings ‚Üí Create Product Order

Required Fields:
- Customer (select)
- Booking Type (Rental/Sale)
- Event Date
- Delivery Date
- Return Date (for rentals)
- Products (select + quantity)
- Payment Type (Full/Advance/Partial)

‚úÖ Test: Create 5-10 test orders
```

**Common Errors:**
- ‚ùå Customer doesn't exist ‚Üí Create customer first
- ‚ùå Product stock = 0 ‚Üí Add stock first
- ‚ùå Dates in past ‚Üí Use future dates
- ‚ùå Delivery date > Return date ‚Üí Check date logic

**How to Fix:**
- Always create customer first (Step 2.1)
- Verify product stock_available > 0
- Delivery ‚â§ Event ‚â§ Return (chronological order)

---

#### **Step 4.3: Create Package Bookings**
```
Location: Bookings ‚Üí Create Package Booking

Required Fields:
- Customer
- Event Date
- Package (select)
- Variant (select)
- Quantity
- Extra Safas (optional)
- Payment details

‚úÖ Test: Create 3-5 package bookings
```

---

#### **Step 4.4: Generate Invoices**
```
Why Now: After booking is confirmed
Location: Bookings ‚Üí View Booking ‚Üí Generate Invoice

Options:
- Manual: Click "Generate Invoice" button
- Auto: Enabled via trigger (optional)

‚úÖ Test: Generate invoice for 1 booking
```

---

#### **Step 4.5: Record Payments**
```
Location: Bookings ‚Üí View ‚Üí Add Payment

Required Fields:
- Payment Amount
- Payment Method (Cash/UPI/Card/Bank)
- Payment Date
- Reference Number (optional)

‚úÖ Test: Add payment to 1 booking
```

---

#### **Step 4.6: Create Delivery Records**
```
Location: Deliveries ‚Üí Create Delivery

Required Fields:
- Booking (select)
- Delivery Date
- Delivery Address
- Delivery Charge
- Driver/Staff (optional)

‚úÖ Test: Create 1 delivery
```

---

#### **Step 4.7: Process Returns**
```
Location: Returns ‚Üí Create Return

Required Fields:
- Booking/Delivery
- Return Date
- Items returned
- Condition (Good/Damaged)
- Send to laundry? (Yes/No)

‚úÖ Test: Process 1 return
```

---

### **Phase 5: Support Systems** (Ongoing)

#### **Step 5.1: Laundry Management**
```
Location: Laundry ‚Üí Create Batch

When: After returns, before making items available

Process:
1. Create laundry batch
2. Add returned items
3. Send to laundry
4. Mark as completed
5. Items become available

‚úÖ Test: Create 1 laundry batch
```

---

#### **Step 5.2: Expense Management**
```
Location: Expenses ‚Üí Add Expense

Categories:
- Rent
- Salaries
- Utilities
- Marketing
- Maintenance

‚úÖ Test: Add 3-5 expenses
```

---

## üéØ **QUICK START CHECKLIST**

Use this for a new franchise setup:

```
DAY 1: Foundation
‚ñ° Create Franchise
‚ñ° Create Admin User
‚ñ° Create 5 Customers
‚ñ° Create 5 Product Categories
‚ñ° Create 20 Products (with stock)

DAY 2: Advanced Setup
‚ñ° Create 3 Package Categories
‚ñ° Create 10 Package Sets
‚ñ° Create 20 Package Variants
‚ñ° Generate barcodes for top 5 products

DAY 3: Test Transactions
‚ñ° Create 3 test quotes
‚ñ° Create 5 product orders
‚ñ° Create 3 package bookings
‚ñ° Generate 2 invoices
‚ñ° Record 3 payments
‚ñ° Create 2 deliveries

DAY 4: Support Systems
‚ñ° Process 1 return
‚ñ° Create 1 laundry batch
‚ñ° Add 5 expenses
‚ñ° Review reports

READY FOR PRODUCTION! ‚úÖ
```

---

## ‚ö†Ô∏è **COMMON ERROR PATTERNS**

### **Error 1: "Foreign Key Violation - franchise_id"**
```
Problem: Trying to create something without a franchise
Solution: Always create Franchise first (Step 1.1)
```

### **Error 2: "Foreign Key Violation - customer_id"**
```
Problem: Trying to create booking without customer
Solution: Create customer first (Step 2.1)
```

### **Error 3: "Foreign Key Violation - product_id"**
```
Problem: Trying to add product that doesn't exist
Solution: Create product first (Step 2.3)
```

### **Error 4: "Stock Unavailable"**
```
Problem: Product stock_available = 0
Solution: Edit product ‚Üí Set stock_available > 0
```

### **Error 5: "Duplicate Key Violation"**
```
Problem: Using same code/email/phone twice
Solution: Use unique values for:
  - Franchise codes (DEL-001, DEL-002)
  - Product codes (TUR-001, TUR-002)
  - Customer phones (per franchise)
  - User emails (globally unique)
```

### **Error 6: "Auto-Generate Barcodes Not Working"**
```
Problem: Trigger not installed or disabled
Solution: Run AUTO_GENERATE_BARCODES_ON_STOCK_CHANGE.sql
```

---

## üîß **TROUBLESHOOTING GUIDE**

### **"Can't Create Booking"**
Check:
1. ‚úÖ Customer exists?
2. ‚úÖ Product exists and stock > 0?
3. ‚úÖ Franchise assigned?
4. ‚úÖ Dates are valid (future)?

### **"Can't See My Data"**
Check:
1. ‚úÖ Logged in with correct franchise?
2. ‚úÖ Data has correct franchise_id?
3. ‚úÖ User role has permissions?

### **"Barcode Scanner Not Finding Items"**
Check:
1. ‚úÖ Items generated in product_items table?
2. ‚úÖ Item status = 'available'?
3. ‚úÖ Barcode format correct?
4. ‚úÖ Scanner configured properly?

---

## üìä **DEPENDENCY MATRIX**

| To Create | You Need First |
|-----------|---------------|
| **Users** | Franchises |
| **Customers** | Franchises |
| **Products** | Franchises (+ Categories optional) |
| **Packages** | Franchises + Package Categories |
| **Package Variants** | Package Sets |
| **Product Items** | Products |
| **Quotes** | Customers + Products/Packages |
| **Product Orders** | Customers + Products |
| **Package Bookings** | Customers + Packages + Variants |
| **Invoices** | Bookings |
| **Payments** | Bookings |
| **Deliveries** | Bookings |
| **Returns** | Deliveries/Bookings |
| **Laundry** | Products |
| **Expenses** | Franchises |

---

## üéì **BEST PRACTICES**

### **1. Always Start with Test Data**
- Create 1 franchise
- Create 1 admin user
- Create 5 test customers
- Create 10 test products
- Create 3 test bookings
- **Test everything before production!**

### **2. Use Consistent Naming**
- Franchise codes: CITY-NUM (DEL-001, MUM-001)
- Product codes: CAT-NUM (TUR-001, SHE-001)
- Customer codes: Auto-generated
- Package codes: Auto-generated

### **3. Set Realistic Stock**
- Don't set stock = 1000 unless you have 1000 items
- If using barcodes, stock = number of barcoded items
- Update stock regularly

### **4. Enable Auto-Features**
- Auto-generate barcodes: ‚úÖ ON
- Auto-generate invoices: ‚úÖ ON
- Auto-sync quantities: ‚úÖ ON

### **5. Regular Data Cleanup**
- Archive old bookings (yearly)
- Remove duplicate customers
- Update product prices
- Review and delete test data

---

## üöÄ **PRODUCTION READINESS CHECKLIST**

Before going live:

```
‚ñ° Database Setup
  ‚ñ° All SQL scripts run successfully
  ‚ñ° Triggers installed and tested
  ‚ñ° Indexes created for performance
  
‚ñ° Master Data
  ‚ñ° Real franchise details entered
  ‚ñ° Staff accounts created
  ‚ñ° At least 50 real customers
  ‚ñ° At least 100 products with stock
  ‚ñ° Package catalog complete
  
‚ñ° System Configuration
  ‚ñ° Branding settings configured
  ‚ñ° Banking details added
  ‚ñ° Terms & conditions set
  ‚ñ° Distance pricing configured
  
‚ñ° Testing
  ‚ñ° Created test bookings
  ‚ñ° Generated test invoices
  ‚ñ° Processed test payments
  ‚ñ° Created test deliveries
  ‚ñ° Processed test returns
  ‚ñ° All reports working
  
‚ñ° User Training
  ‚ñ° Staff trained on system
  ‚ñ° Process workflows documented
  ‚ñ° Support contact available
  
‚ñ° Backup
  ‚ñ° Database backup strategy
  ‚ñ° Daily auto-backups enabled
  ‚ñ° Test restore procedure
```

---

## üìû **NEED HELP?**

If you encounter errors:

1. **Check this guide first** - Find your error above
2. **Run verification queries** - See what's missing
3. **Check console logs** - Browser F12 ‚Üí Console tab
4. **Review database** - Supabase dashboard ‚Üí Table editor

---

**‚úÖ Follow this workflow exactly and you'll have ZERO errors!** üéâ

**Created: October 2025**  
**Version: 2.0**  
**Status: Production Ready**
