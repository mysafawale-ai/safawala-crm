-- Create comprehensive dummy data for Safawala CRM
-- This script creates franchises, users, customers, products, bookings, and booking items

-- First, let's ensure we have a franchise
INSERT INTO franchises (
  id,
  name,
  code,
  address,
  city,
  state,
  pincode,
  phone,
  email,
  owner_name,
  gst_number,
  is_active
) VALUES (
  '11111111-1111-1111-1111-111111111111',
  'Safawala Main Branch',
  'MAIN001',
  '123 Wedding Street, Bridal Market',
  'Delhi',
  'Delhi',
  '110001',
  '+91-9876543210',
  'main@safawala.com',
  'Rajesh Safawala',
  '07AAACH7409R1ZZ',
  true
) ON CONFLICT (id) DO UPDATE SET
  name = EXCLUDED.name,
  code = EXCLUDED.code,
  address = EXCLUDED.address,
  city = EXCLUDED.city,
  state = EXCLUDED.state,
  pincode = EXCLUDED.pincode,
  phone = EXCLUDED.phone,
  email = EXCLUDED.email,
  owner_name = EXCLUDED.owner_name,
  gst_number = EXCLUDED.gst_number,
  is_active = EXCLUDED.is_active;

-- Create users
INSERT INTO users (
  id,
  name,
  email,
  role,
  franchise_id,
  password_hash,
  is_active
) VALUES 
(
  '22222222-2222-2222-2222-222222222222',
  'Admin User',
  'admin@safawala.com',
  'admin',
  '11111111-1111-1111-1111-111111111111',
  '$2a$10$example_hash_admin',
  true
),
(
  '33333333-3333-3333-3333-333333333333',
  'Manager Singh',
  'manager@safawala.com',
  'manager',
  '11111111-1111-1111-1111-111111111111',
  '$2a$10$example_hash_manager',
  true
),
(
  '44444444-4444-4444-4444-444444444444',
  'Staff Kumar',
  'staff@safawala.com',
  'staff',
  '11111111-1111-1111-1111-111111111111',
  '$2a$10$example_hash_staff',
  true
) ON CONFLICT (email) DO UPDATE SET
  name = EXCLUDED.name,
  role = EXCLUDED.role,
  franchise_id = EXCLUDED.franchise_id,
  is_active = EXCLUDED.is_active;

-- Create customers
INSERT INTO customers (
  id,
  customer_code,
  name,
  phone,
  whatsapp,
  email,
  address,
  city,
  pincode,
  gst_number,
  credit_limit,
  outstanding_balance,
  total_bookings,
  total_spent,
  franchise_id
) VALUES 
(
  'c1111111-1111-1111-1111-111111111111',
  'CUST001',
  'Rajesh Kumar',
  '+91-9876543210',
  '+91-9876543210',
  'rajesh@email.com',
  '456 MG Road, Connaught Place',
  'Delhi',
  '110001',
  null,
  100000,
  0,
  3,
  85000,
  '11111111-1111-1111-1111-111111111111'
),
(
  'c2222222-2222-2222-2222-222222222222',
  'CUST002',
  'Priya Sharma',
  '+91-9876543211',
  '+91-9876543211',
  'priya@email.com',
  '789 Park Street, Karol Bagh',
  'Delhi',
  '110005',
  null,
  150000,
  5000,
  2,
  45000,
  '11111111-1111-1111-1111-111111111111'
),
(
  'c3333333-3333-3333-3333-333333333333',
  'CUST003',
  'Amit Patel',
  '+91-9876543212',
  '+91-9876543212',
  'amit@email.com',
  '321 Rose Garden, Lajpat Nagar',
  'Delhi',
  '110024',
  null,
  80000,
  0,
  1,
  25000,
  '11111111-1111-1111-1111-111111111111'
),
(
  'c4444444-4444-4444-4444-444444444444',
  'CUST004',
  'Sneha Gupta',
  '+91-9876543213',
  '+91-9876543213',
  'sneha@email.com',
  '654 Green Park, South Delhi',
  'Delhi',
  '110016',
  null,
  200000,
  15000,
  4,
  120000,
  '11111111-1111-1111-1111-111111111111'
),
(
  'c5555555-5555-5555-5555-555555555555',
  'CUST005',
  'Vikram Singh',
  '+91-9876543214',
  '+91-9876543214',
  'vikram@email.com',
  '987 Defence Colony, New Delhi',
  'Delhi',
  '110024',
  null,
  300000,
  25000,
  2,
  75000,
  '11111111-1111-1111-1111-111111111111'
) ON CONFLICT (customer_code) DO UPDATE SET
  name = EXCLUDED.name,
  phone = EXCLUDED.phone,
  whatsapp = EXCLUDED.whatsapp,
  email = EXCLUDED.email,
  address = EXCLUDED.address,
  city = EXCLUDED.city,
  pincode = EXCLUDED.pincode,
  credit_limit = EXCLUDED.credit_limit,
  outstanding_balance = EXCLUDED.outstanding_balance,
  total_bookings = EXCLUDED.total_bookings,
  total_spent = EXCLUDED.total_spent;

-- Create products
INSERT INTO products (
  id,
  product_code,
  name,
  category,
  description,
  brand,
  color,
  material,
  price,
  rental_price,
  cost_price,
  security_deposit,
  stock_total,
  stock_available,
  stock_booked,
  stock_damaged,
  stock_in_laundry,
  reorder_level,
  usage_count,
  damage_count,
  franchise_id,
  is_active
) VALUES 
(
  'p1111111-1111-1111-1111-111111111111',
  'SHW001',
  'Royal Groom Sherwani',
  'Groom Wear',
  'Elegant cream colored sherwani with golden embroidery',
  'Royal Collection',
  'Cream & Gold',
  'Silk',
  75000,
  15000,
  60000,
  25000,
  10,
  7,
  3,
  0,
  0,
  2,
  25,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p2222222-2222-2222-2222-222222222222',
  'JWL001',
  'Diamond Necklace Set',
  'Jewelry',
  'Beautiful diamond necklace with matching earrings',
  'Diamond Collection',
  'Silver',
  'Silver & Diamond',
  50000,
  2500,
  40000,
  5000,
  8,
  6,
  2,
  0,
  0,
  1,
  20,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p3333333-3333-3333-3333-333333333333',
  'DEC001',
  'Wedding Stage Decoration',
  'Decoration',
  'Complete stage decoration with flowers and lighting',
  'Stage Craft',
  'Multi-color',
  'Fabric & Flowers',
  100000,
  8000,
  80000,
  10000,
  5,
  3,
  2,
  0,
  0,
  1,
  15,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p4444444-4444-4444-4444-444444444444',
  'SHW002',
  'Designer Groom Sherwani',
  'Groom Wear',
  'Royal blue sherwani with golden embroidery',
  'Royal Collection',
  'Blue & Gold',
  'Silk',
  80000,
  8000,
  65000,
  15000,
  8,
  6,
  2,
  0,
  0,
  2,
  18,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p5555555-5555-5555-5555-555555555555',
  'JWL002',
  'Gold Bracelet Set',
  'Jewelry',
  'Traditional gold bracelet with intricate designs',
  'Gold Collection',
  'Gold',
  'Gold',
  35000,
  1800,
  28000,
  3500,
  12,
  10,
  2,
  0,
  0,
  2,
  30,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p6666666-6666-6666-6666-666666666666',
  'ACC001',
  'Bridal Makeup Kit',
  'Accessories',
  'Complete bridal makeup kit with premium products',
  'Beauty Pro',
  'Multi-color',
  'Cosmetics',
  15000,
  1500,
  12000,
  2000,
  15,
  12,
  3,
  0,
  0,
  3,
  40,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p7777777-7777-7777-7777-777777777777',
  'FUR001',
  'Wedding Seating Set',
  'Furniture',
  'Elegant chairs and tables for wedding ceremony',
  'Event Furniture',
  'Golden',
  'Wood & Metal',
  120000,
  5000,
  100000,
  8000,
  50,
  45,
  5,
  0,
  0,
  10,
  25,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
),
(
  'p8888888-8888-8888-8888-888888888888',
  'LIG001',
  'LED Lighting Setup',
  'Lighting',
  'Professional LED lighting for wedding events',
  'Light Pro',
  'Multi-color',
  'LED & Electronics',
  60000,
  3000,
  48000,
  6000,
  20,
  18,
  2,
  0,
  0,
  5,
  35,
  0,
  '11111111-1111-1111-1111-111111111111',
  true
) ON CONFLICT (product_code) DO UPDATE SET
  name = EXCLUDED.name,
  category = EXCLUDED.category,
  description = EXCLUDED.description,
  brand = EXCLUDED.brand,
  color = EXCLUDED.color,
  material = EXCLUDED.material,
  price = EXCLUDED.price,
  rental_price = EXCLUDED.rental_price,
  cost_price = EXCLUDED.cost_price,
  security_deposit = EXCLUDED.security_deposit,
  stock_total = EXCLUDED.stock_total,
  stock_available = EXCLUDED.stock_available,
  stock_booked = EXCLUDED.stock_booked,
  usage_count = EXCLUDED.usage_count,
  is_active = EXCLUDED.is_active;

-- Create bookings with comprehensive data
INSERT INTO bookings (
  id,
  booking_number,
  customer_id,
  franchise_id,
  type,
  event_type,
  payment_type,
  total_amount,
  discount_amount,
  tax_amount,
  security_deposit,
  amount_paid,
  pending_amount,
  refund_amount,
  status,
  priority,
  event_date,
  delivery_date,
  pickup_date,
  groom_name,
  bride_name,
  venue_name,
  venue_address,
  special_instructions,
  invoice_generated,
  whatsapp_sent,
  created_by,
  created_at,
  updated_at
) VALUES 
(
  'b1111111-1111-1111-1111-111111111111',
  'REN001',
  'c1111111-1111-1111-1111-111111111111',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'wedding',
  'advance',
  29440,
  0,
  4440,
  35000,
  14720,
  14720,
  0,
  'confirmed',
  1,
  '2024-03-25',
  '2024-03-23',
  '2024-03-27',
  'Rajesh Kumar',
  'Priya Sharma',
  'Grand Palace Hotel',
  '123 Wedding Street, Delhi - 110001',
  'Please ensure all items are delivered by 10 AM. Handle with care.',
  true,
  true,
  '22222222-2222-2222-2222-222222222222',
  '2024-02-15T10:00:00Z',
  '2024-02-20T15:30:00Z'
),
(
  'b2222222-2222-2222-2222-222222222222',
  'REN002',
  'c2222222-2222-2222-2222-222222222222',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'engagement',
  'full',
  18880,
  500,
  2880,
  20000,
  18880,
  0,
  0,
  'delivered',
  2,
  '2024-03-18',
  '2024-03-17',
  '2024-03-19',
  'Amit Patel',
  'Neha Gupta',
  'City Convention Center',
  '456 Celebration Avenue, Delhi - 110024',
  'Call before delivery. Venue contact: 9876543210',
  true,
  true,
  '33333333-3333-3333-3333-333333333333',
  '2024-02-12T10:00:00Z',
  '2024-03-17T09:00:00Z'
),
(
  'b3333333-3333-3333-3333-333333333333',
  'SAL001',
  'c3333333-3333-3333-3333-333333333333',
  '11111111-1111-1111-1111-111111111111',
  'direct_sale',
  'wedding',
  'advance',
  59000,
  2000,
  9000,
  0,
  35400,
  23600,
  0,
  'pending',
  1,
  '2024-03-30',
  '2024-03-28',
  null,
  'Vikram Singh',
  'Kavya Reddy',
  'Royal Gardens',
  '789 Royal Road, Jaipur - 302001',
  'Premium packaging required. Include care instructions.',
  false,
  false,
  '44444444-4444-4444-4444-444444444444',
  '2024-02-08T10:00:00Z',
  '2024-02-08T10:00:00Z'
),
(
  'b4444444-4444-4444-4444-444444444444',
  'REN003',
  'c4444444-4444-4444-4444-444444444444',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'reception',
  'advance_with_deposit',
  47200,
  1000,
  7200,
  25000,
  48600,
  23600,
  0,
  'returned',
  3,
  '2024-02-28',
  '2024-02-26',
  '2024-03-02',
  'Arjun Mehta',
  'Sneha Gupta',
  'Taj Palace',
  '321 Luxury Lane, Mumbai - 400001',
  'VIP treatment required. Extra security for jewelry items.',
  true,
  true,
  '22222222-2222-2222-2222-222222222222',
  '2024-01-25T10:00:00Z',
  '2024-03-02T18:00:00Z'
),
(
  'b5555555-5555-5555-5555-555555555555',
  'REN004',
  'c5555555-5555-5555-5555-555555555555',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'sangeet',
  'full',
  14160,
  0,
  2160,
  15000,
  14160,
  0,
  0,
  'completed',
  2,
  '2024-02-14',
  '2024-02-13',
  '2024-02-15',
  'Rohit Sharma',
  'Anjali Singh',
  'Music Hall',
  '654 Dance Street, Pune - 411001',
  'Setup required by 6 PM. Sound system coordination needed.',
  true,
  true,
  '33333333-3333-3333-3333-333333333333',
  '2024-01-20T10:00:00Z',
  '2024-02-15T20:00:00Z'
),
(
  'b6666666-6666-6666-6666-666666666666',
  'REN005',
  'c1111111-1111-1111-1111-111111111111',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'mehendi',
  'advance',
  23600,
  0,
  3600,
  12000,
  11800,
  11800,
  0,
  'pending',
  1,
  '2024-04-05',
  '2024-04-04',
  '2024-04-06',
  'Karan Johar',
  'Priya Sharma',
  'Garden Resort',
  '987 Green Valley, Goa - 403001',
  'Outdoor setup. Weather backup plan required.',
  false,
  false,
  '44444444-4444-4444-4444-444444444444',
  '2024-03-01T10:00:00Z',
  '2024-03-01T10:00:00Z'
),
(
  'b7777777-7777-7777-7777-777777777777',
  'SAL002',
  'c2222222-2222-2222-2222-222222222222',
  '11111111-1111-1111-1111-111111111111',
  'direct_sale',
  'engagement',
  'full',
  41300,
  0,
  6300,
  0,
  41300,
  0,
  0,
  'completed',
  2,
  '2024-02-20',
  '2024-02-19',
  null,
  'Suresh Kumar',
  'Meera Patel',
  'Hotel Grandeur',
  '123 Elite Road, Bangalore - 560001',
  'Gift wrapping required. Include warranty cards.',
  true,
  true,
  '22222222-2222-2222-2222-222222222222',
  '2024-01-15T10:00:00Z',
  '2024-02-20T16:00:00Z'
),
(
  'b8888888-8888-8888-8888-888888888888',
  'REN006',
  'c3333333-3333-3333-3333-333333333333',
  '11111111-1111-1111-1111-111111111111',
  'rental',
  'wedding',
  'advance',
  35400,
  500,
  5400,
  28000,
  17700,
  17700,
  0,
  'cancelled',
  1,
  '2024-04-15',
  '2024-04-13',
  '2024-04-17',
  'Deepak Singh',
  'Ritu Sharma',
  'Palace Grounds',
  '456 Royal Street, Udaipur - 313001',
  'Cancelled due to venue change. Refund processed.',
  false,
  false,
  '33333333-3333-3333-3333-333333333333',
  '2024-02-28T10:00:00Z',
  '2024-03-05T14:00:00Z'
) ON CONFLICT (booking_number) DO UPDATE SET
  customer_id = EXCLUDED.customer_id,
  franchise_id = EXCLUDED.franchise_id,
  type = EXCLUDED.type,
  event_type = EXCLUDED.event_type,
  payment_type = EXCLUDED.payment_type,
  total_amount = EXCLUDED.total_amount,
  discount_amount = EXCLUDED.discount_amount,
  tax_amount = EXCLUDED.tax_amount,
  security_deposit = EXCLUDED.security_deposit,
  amount_paid = EXCLUDED.amount_paid,
  pending_amount = EXCLUDED.pending_amount,
  status = EXCLUDED.status,
  priority = EXCLUDED.priority,
  event_date = EXCLUDED.event_date,
  delivery_date = EXCLUDED.delivery_date,
  pickup_date = EXCLUDED.pickup_date,
  groom_name = EXCLUDED.groom_name,
  bride_name = EXCLUDED.bride_name,
  venue_name = EXCLUDED.venue_name,
  venue_address = EXCLUDED.venue_address,
  special_instructions = EXCLUDED.special_instructions,
  invoice_generated = EXCLUDED.invoice_generated,
  whatsapp_sent = EXCLUDED.whatsapp_sent,
  updated_at = EXCLUDED.updated_at;

-- Create booking items for each booking
INSERT INTO booking_items (
  id,
  booking_id,
  product_id,
  quantity,
  unit_price,
  discount_percent,
  total_price,
  security_deposit,
  damage_cost,
  cleaning_required
) VALUES 
-- Booking 1 items (REN001)
(
  'bi111111-1111-1111-1111-111111111111',
  'b1111111-1111-1111-1111-111111111111',
  'p1111111-1111-1111-1111-111111111111',
  1,
  15000,
  0,
  15000,
  25000,
  0,
  false
),
(
  'bi111112-1111-1111-1111-111111111111',
  'b1111111-1111-1111-1111-111111111111',
  'p2222222-2222-2222-2222-222222222222',
  1,
  2500,
  0,
  2500,
  5000,
  0,
  false
),
(
  'bi111113-1111-1111-1111-111111111111',
  'b1111111-1111-1111-1111-111111111111',
  'p3333333-3333-3333-3333-333333333333',
  1,
  8000,
  0,
  8000,
  10000,
  0,
  false
),
-- Booking 2 items (REN002)
(
  'bi222221-1111-1111-1111-111111111111',
  'b2222222-2222-2222-2222-222222222222',
  'p4444444-4444-4444-4444-444444444444',
  1,
  8000,
  0,
  8000,
  15000,
  0,
  true
),
(
  'bi222222-1111-1111-1111-111111111111',
  'b2222222-2222-2222-2222-222222222222',
  'p5555555-5555-5555-5555-555555555555',
  2,
  1800,
  0,
  3600,
  7000,
  0,
  false
),
(
  'bi222223-1111-1111-1111-111111111111',
  'b2222222-2222-2222-2222-222222222222',
  'p6666666-6666-6666-6666-666666666666',
  3,
  1500,
  5,
  4275,
  6000,
  0,
  false
),
-- Booking 3 items (SAL001)
(
  'bi333331-1111-1111-1111-111111111111',
  'b3333333-3333-3333-3333-333333333333',
  'p1111111-1111-1111-1111-111111111111',
  1,
  75000,
  0,
  75000,
  0,
  0,
  false
),
(
  'bi333332-1111-1111-1111-111111111111',
  'b3333333-3333-3333-3333-333333333333',
  'p2222222-2222-2222-2222-222222222222',
  1,
  50000,
  0,
  50000,
  0,
  0,
  false
),
-- Booking 4 items (REN003)
(
  'bi444441-1111-1111-1111-111111111111',
  'b4444444-4444-4444-4444-444444444444',
  'p7777777-7777-7777-7777-777777777777',
  10,
  5000,
  0,
  50000,
  80000,
  0,
  true
),
(
  'bi444442-1111-1111-1111-111111111111',
  'b4444444-4444-4444-4444-444444444444',
  'p8888888-8888-8888-8888-888888888888',
  2,
  3000,
  0,
  6000,
  12000,
  0,
  false
),
-- Booking 5 items (REN004)
(
  'bi555551-1111-1111-1111-111111111111',
  'b5555555-5555-5555-5555-555555555555',
  'p8888888-8888-8888-8888-888888888888',
  4,
  3000,
  0,
  12000,
  24000,
  0,
  false
),
-- Booking 6 items (REN005)
(
  'bi666661-1111-1111-1111-111111111111',
  'b6666666-6666-6666-6666-666666666666',
  'p6666666-6666-6666-6666-666666666666',
  5,
  1500,
  0,
  7500,
  10000,
  0,
  false
),
(
  'bi666662-1111-1111-1111-111111111111',
  'b6666666-6666-6666-6666-666666666666',
  'p3333333-3333-3333-3333-333333333333',
  1,
  8000,
  0,
  8000,
  10000,
  0,
  false
),
(
  'bi666663-1111-1111-1111-111111111111',
  'b6666666-6666-6666-6666-666666666666',
  'p5555555-5555-5555-5555-555555555555',
  2,
  1800,
  0,
  3600,
  7000,
  0,
  false
),
-- Booking 7 items (SAL002)
(
  'bi777771-1111-1111-1111-111111111111',
  'b7777777-7777-7777-7777-777777777777',
  'p2222222-2222-2222-2222-222222222222',
  1,
  50000,
  0,
  50000,
  0,
  0,
  false
),
-- Booking 8 items (REN006 - Cancelled)
(
  'bi888881-1111-1111-1111-111111111111',
  'b8888888-8888-8888-8888-888888888888',
  'p1111111-1111-1111-1111-111111111111',
  2,
  15000,
  0,
  30000,
  50000,
  0,
  false
) ON CONFLICT (id) DO UPDATE SET
  booking_id = EXCLUDED.booking_id,
  product_id = EXCLUDED.product_id,
  quantity = EXCLUDED.quantity,
  unit_price = EXCLUDED.unit_price,
  discount_percent = EXCLUDED.discount_percent,
  total_price = EXCLUDED.total_price,
  security_deposit = EXCLUDED.security_deposit,
  damage_cost = EXCLUDED.damage_cost,
  cleaning_required = EXCLUDED.cleaning_required;

-- Update customer statistics based on bookings
UPDATE customers SET
  total_bookings = (
    SELECT COUNT(*) FROM bookings 
    WHERE customer_id = customers.id
  ),
  total_spent = (
    SELECT COALESCE(SUM(total_amount), 0) FROM bookings 
    WHERE customer_id = customers.id AND status != 'cancelled'
  ),
  outstanding_balance = (
    SELECT COALESCE(SUM(pending_amount), 0) FROM bookings 
    WHERE customer_id = customers.id AND status IN ('pending', 'confirmed', 'delivered')
  );

-- Update product usage counts
UPDATE products SET
  usage_count = (
    SELECT COALESCE(SUM(bi.quantity), 0) 
    FROM booking_items bi 
    JOIN bookings b ON bi.booking_id = b.id 
    WHERE bi.product_id = products.id AND b.status != 'cancelled'
  );

-- Final verification and summary
SELECT 
    'Comprehensive Dummy Data Created Successfully!' as status,
    (SELECT count(*) FROM franchises) as franchises,
    (SELECT count(*) FROM users) as users,
    (SELECT count(*) FROM customers) as customers,
    (SELECT count(*) FROM products) as products,
    (SELECT count(*) FROM bookings) as bookings,
    (SELECT count(*) FROM booking_items) as booking_items,
    (SELECT count(*) FROM bookings WHERE status = 'pending') as pending_bookings,
    (SELECT count(*) FROM bookings WHERE status = 'confirmed') as confirmed_bookings,
    (SELECT count(*) FROM bookings WHERE status = 'delivered') as delivered_bookings,
    (SELECT count(*) FROM bookings WHERE status = 'completed') as completed_bookings,
    (SELECT COALESCE(SUM(total_amount), 0) FROM bookings WHERE status != 'cancelled') as total_revenue;
